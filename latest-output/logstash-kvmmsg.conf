# Config file generated by RSA2ELK, see https://github.com/blookot/rsa2elk 
# Author: Vincent Maury
# Check all Netwitness parsers: https://github.com/netwitness/nw-logparsers/tree/master/devices/ (license: Apache 2.0)
# Check this link to search for source configuration guides: https://rsa.jiveon.com/community/products/netwitness/integrations/event-sources

##########
# CAUTION: check the "path" in input and "dictionary_path" in filter, as well as the "template" path in the elasticsearch output or "path" in the file output
##########

input {
#	syslog {
#		port => 514
#	}
#	file {
#		path => "/var/log/example.log"
#		start_position => "beginning"
#		sincedb_path => "/dev/null"
#	}
	generator {
		count => 1
		message => "a log line to test out"
	}
#	kafka {
#		codec => "json"
#		bootstrap_servers => "192.168.30.13:9092"
#		topics => ["mytopic"]
#		security_protocol => "SSL"
#		ssl_key_password => "{ssl_password}"
#		ssl_keystore_location => "/{keystore-absolute-path}"
#		ssl_keystore_password => "{keystore_password}"
#		ssl_truststore_location => "/{truststore-absolute-path}"
#		ssl_truststore_password => "{truststore_password}"
#	}
}

# Renaming a couple of fields
filter {
	mutate {
		rename => {
			"message" => "[event][original]"
			"host" => "[logstash][host]"
		}
	}
}

# Setting the device name and group
filter {
	mutate {
		add_field => {
			"[observer][product]" => "kvm"
			"[observer][name]" => "Kernel-based Virtual Machine"
			"[observer][type]" => "Virtualization"
		}
	}
}


# One single filter block for all headers and messages
filter {

################## HEADERS ##################

	# HEADER 0001
	# line in RSA: %KVM-<hfld1>: type=<messageid> <!payload>
	if ![logstash][headerfound] {
		dissect {
			mapping => { "[event][original]" => "%KVM-%{hfld1}: type=%{messageid} %{message}" }
			id => "header-0001"
			add_field => {
				"[rsa][header][id]" => "0001"
				"[rsa][message][id2]" => "%{messageid}"
				"[logstash][headerfound]" => true
			}
		}
	}



################## MsgId2 to Parser ##################

	translate {
		field => "[rsa][message][id2]"
		destination => "[logstash][msgparser][id]"
		dictionary_path => "msgid2parserid-kvmmsg.json"
		fallback => ""
		override => true
	}


################## MESSAGES ##################

	# PARSER msgParserId0
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> acct=<fld8> exe=<fld9> hostname=<hostname> addr=<fld10> terminal=<fld11> res=<result>'
	if [logstash][msgparser][id] == "msgParserId0" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} acct=%{fld8} exe=%{fld9} hostname=%{hostname} addr=%{fld10} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId0"
			add_field => {
				"action" => "User Account"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId1
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> acct=<fld8> exe=<fld9> hostname=<hostname> addr=<fld10> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId1" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} acct=%{fld8} exe=%{fld9} hostname=%{hostname} addr=%{fld10} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId1"
			add_field => {
				"action" => "Cred ACQ"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId2
	# line in RSA:  msg=<fld2> pid=<fld3> uid=<fld4> subj=<fld7> old auid=<fld8> new auid=<fld9> old ses=<fld10> new ses=<fld11>
	else if [logstash][msgparser][id] == "msgParserId2" {
		dissect {
			mapping => { "message" => "msg=%{fld2} pid=%{fld3} uid=%{fld4} subj=%{fld7} old auid=%{fld8} new auid=%{fld9} old ses=%{fld10} new ses=%{fld11}" }
			id => "msgParserId2"
			add_field => {
				"action" => "Login"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId3
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> { acct | id }=<fld8> exe=<fld9> hostname=<hostname> addr=<fld10> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId3" {
		grok {
			match => { "message" => "^[\s]*msg=(?<fld2>[^\s]*)[\s]+user[\s]+pid=(?<fld3>[^\s]*)[\s]+uid=(?<fld4>[^\s]*)[\s]+auid=(?<fld5>[^\s]*)[\s]+ses=(?<fld6>[^\s]*)[\s]+subj=(?<fld7>[^\s]*)[\s]+msg='op=(?<info>[^\s]*)[\s]+([\s]*acct[\s]+|[\s]*id[\s]+)=(?<fld8>[^\s]*)[\s]+exe=(?<fld9>[^\s]*)[\s]+hostname=(?<hostname>[^\s]*)[\s]+addr=(?<fld10>[^\s]*)[\s]+terminal=(?<fld11>[^\s]*)[\s]+res=(?<result>[^']*)'$" }
			id => "msgParserId3"
			add_field => {
				"action" => "user start"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId4
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> acct=<fld8> exe=<fld9> hostname=<hostname> addr=<fld10> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId4" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} acct=%{fld8} exe=%{fld9} hostname=%{hostname} addr=%{fld10} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId4"
			add_field => {
				"action" => "Cred disp"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId5
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> { acct | id }=<fld8> exe=<fld9> hostname=<hostname> addr=<fld10> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId5" {
		grok {
			match => { "message" => "^[\s]*msg=(?<fld2>[^\s]*)[\s]+user[\s]+pid=(?<fld3>[^\s]*)[\s]+uid=(?<fld4>[^\s]*)[\s]+auid=(?<fld5>[^\s]*)[\s]+ses=(?<fld6>[^\s]*)[\s]+subj=(?<fld7>[^\s]*)[\s]+msg='op=(?<info>[^\s]*)[\s]+([\s]*acct[\s]+|[\s]*id[\s]+)=(?<fld8>[^\s]*)[\s]+exe=(?<fld9>[^\s]*)[\s]+hostname=(?<hostname>[^\s]*)[\s]+addr=(?<fld10>[^\s]*)[\s]+terminal=(?<fld11>[^\s]*)[\s]+res=(?<result>[^']*)'$" }
			id => "msgParserId5"
			add_field => {
				"action" => "user end"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId6
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> direction=<fld8> cipher=<fld9> ksize=<fld10> spid=<fld11> suid=<fld12> rport=<fld13> laddr=<saddr> lport=<sport> : exe=<fld14> hostname=<hostname> addr=<fld15> terminal=<fld16> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId6" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} direction=%{fld8} cipher=%{fld9} ksize=%{fld10} spid=%{fld11} suid=%{fld12} rport=%{fld13} laddr=%{saddr} lport=%{sport} : exe=%{fld14} hostname=%{hostname} addr=%{fld15} terminal=%{fld16} res=%{result}'" }
			id => "msgParserId6"
			add_field => {
				"action" => "crypto session"
				"[logstash][messagefound]" => true
			}
		}
	}
	else if [logstash][msgparser][id] == "CRYPTO_KEY_USER" {
		# MESSAGE CRYPTO_KEY_USER
		# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> kind=<fld20> fp=<fld21> direction=<fld8> spid=<fld11> suid=<fld12> rport=<fld13> laddr=<saddr> lport=<sport> : exe=<fld14> hostname=<hostname> addr=<fld15> terminal=<fld16> res=<result>'
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} kind=%{fld20} fp=%{fld21} direction=%{fld8} spid=%{fld11} suid=%{fld12} rport=%{fld13} laddr=%{saddr} lport=%{sport} : exe=%{fld14} hostname=%{hostname} addr=%{fld15} terminal=%{fld16} res=%{result}'" }
				id => "message-CRYPTO_KEY_USER"
				add_field => {
				"action" => "crypto key user"
					"[event][id]" => "CRYPTO_KEY_USER"
					"[rsa][message][id1]" => "CRYPTO_KEY_USER"
					"[event][categoryid]" => "1605000000"
					"[logstash][messagefound]" => true
				}
			}
		}
		# MESSAGE CRYPTO_KEY_USER:01
		# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> kind=<fld20> fp=<fld21> direction=<fld8> spid=<fld11> suid=<fld12> : exe=<fld14> hostname=<hostname> addr=<fld15> terminal=<fld16> res=<result>'
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} kind=%{fld20} fp=%{fld21} direction=%{fld8} spid=%{fld11} suid=%{fld12} : exe=%{fld14} hostname=%{hostname} addr=%{fld15} terminal=%{fld16} res=%{result}'" }
				id => "message-CRYPTO_KEY_USER:01"
				add_field => {
				"action" => "crypto key user"
					"[event][id]" => "CRYPTO_KEY_USER:01"
					"[rsa][message][id1]" => "CRYPTO_KEY_USER:01"
					"[event][categoryid]" => "1605000000"
					"[logstash][messagefound]" => true
				}
			}
		}
	}
	# PARSER msgParserId9
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> { acct | id }=<fld8> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId9" {
		grok {
			match => { "message" => "^[\s]*msg=(?<fld2>[^\s]*)[\s]+user[\s]+pid=(?<fld3>[^\s]*)[\s]+uid=(?<fld4>[^\s]*)[\s]+auid=(?<fld5>[^\s]*)[\s]+ses=(?<fld6>[^\s]*)[\s]+subj=(?<fld7>[^\s]*)[\s]+msg='op=(?<info>[^\s]*)[\s]+([\s]*acct[\s]+|[\s]*id[\s]+)=(?<fld8>[^\s]*)[\s]+exe=(?<fld9>[^\s]*)[\s]+hostname=(?<hostname>[^\s]*)[\s]+addr=(?<hostip>[^\s]*)[\s]+terminal=(?<fld11>[^\s]*)[\s]+res=(?<result>[^']*)'$" }
			id => "msgParserId9"
			add_field => {
				"action" => "User Login"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId10
	# line in RSA:  msg=<fld2> auid=<fld5> pid=<fld4> subj=<fld7> res=<result>
	else if [logstash][msgparser][id] == "msgParserId10" {
		dissect {
			mapping => { "message" => "msg=%{fld2} auid=%{fld5} pid=%{fld4} subj=%{fld7} res=%{result}" }
			id => "msgParserId10"
			add_field => {
				"action" => "Daemon End"
				"event_description" => "autitd normal halt, sending"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId11
	# line in RSA:  msg=<fld2> ver=<version> format=<fld3> kernel=<fld4> auid=<fld5> pid=<fld6> subj=<fld7> res=<result>
	else if [logstash][msgparser][id] == "msgParserId11" {
		dissect {
			mapping => { "message" => "msg=%{fld2} ver=%{version} format=%{fld3} kernel=%{fld4} auid=%{fld5} pid=%{fld6} subj=%{fld7} res=%{result}" }
			id => "msgParserId11"
			add_field => {
				"action" => "Daemon Start"
				"event_description" => "autitd start"
				"[logstash][messagefound]" => true
			}
		}
	}
	else if [logstash][msgparser][id] == "CONFIG_CHANGE" {
		# MESSAGE CONFIG_CHANGE
		# line in RSA:  msg=<fld2> { audit_pid | audit_enabled | audit_backlog_limit }=<fld3> old=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> res=<result>
		if ![logstash][messagefound] {
			grok {
				match => { "message" => "^[\s]*msg=(?<fld2>[^\s]*)[\s]+([\s]*audit_pid[\s]+|[\s]*audit_enabled[\s]+|[\s]*audit_backlog_limit[\s]+)=(?<fld3>[^\s]*)[\s]+old=(?<fld4>[^\s]*)[\s]+auid=(?<fld5>[^\s]*)[\s]+ses=(?<fld6>[^\s]*)[\s]+subj=(?<fld7>[^\s]*)[\s]+res=(?<result>.*)$" }
				id => "message-CONFIG_CHANGE"
				add_field => {
				"action" => "Config Change"
					"[event][id]" => "CONFIG_CHANGE"
					"[rsa][message][id1]" => "CONFIG_CHANGE"
					"[event][categoryid]" => "1701000000"
					"[logstash][messagefound]" => true
				}
			}
		}
		# MESSAGE CONFIG_CHANGE:01
		# line in RSA:  msg=<fld2> auid=<fld5> ses=<fld6> subj=<fld7> op=<info> key=<fld8> list=<fld9> res=<result>
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} auid=%{fld5} ses=%{fld6} subj=%{fld7} op=%{info} key=%{fld8} list=%{fld9} res=%{result}" }
				id => "message-CONFIG_CHANGE:01"
				add_field => {
				"action" => "Config Change"
					"[event][id]" => "CONFIG_CHANGE:01"
					"[rsa][message][id1]" => "CONFIG_CHANGE:01"
					"[event][categoryid]" => "1701000000"
					"[logstash][messagefound]" => true
				}
			}
		}
		# MESSAGE CONFIG_CHANGE:02
		# line in RSA:  msg=<fld2> auid=<fld5> ses=<fld6> op=<info> path=<fld7> key=<fld8> list=<fld9> res=<result>
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} auid=%{fld5} ses=%{fld6} op=%{info} path=%{fld7} key=%{fld8} list=%{fld9} res=%{result}" }
				id => "message-CONFIG_CHANGE:02"
				add_field => {
				"action" => "Config Change"
					"[event][id]" => "CONFIG_CHANGE:02"
					"[rsa][message][id1]" => "CONFIG_CHANGE:02"
					"[event][categoryid]" => "1701000000"
					"[logstash][messagefound]" => true
				}
			}
		}
	}
	# PARSER msgParserId15
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> id=<fld8> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId15" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} id=%{fld8} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId15"
			add_field => {
				"action" => "User Logout"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId16
	# line in RSA:  msg=<fld2> dev=<fld3> prom=<fld4> old_prom=<fld5> auid=<fld6> uid=<fld7> gid=<fld8> ses=<fld9>
	else if [logstash][msgparser][id] == "msgParserId16" {
		dissect {
			mapping => { "message" => "msg=%{fld2} dev=%{fld3} prom=%{fld4} old_prom=%{fld5} auid=%{fld6} uid=%{fld7} gid=%{fld8} ses=%{fld9}" }
			id => "msgParserId16"
			add_field => {
				"action" => "anom promiscuous"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId17
	# line in RSA:  msg=<fld2> arch=<fld3> syscall=<fld4> success=<fld5> exit=<fld6> a0=<fld7> a1=<fld8> a2=<fld9> a3=<fld10> items=<fld11> ppid=<fld12> pid=<fld13> auid=<fld14> uid=<fld15> gid=<fld16> euid=<fld17> suid=<fld18> fsuid=<fld19> egid=<fld20> sgid=<fld21> fsgid=<fld22> tty=<fld23> ses=<fld24> comm=<fld25> exe=<fld26> subj=<fld27> key=<fld28> 
	else if [logstash][msgparser][id] == "msgParserId17" {
		dissect {
			mapping => { "message" => "msg=%{fld2} arch=%{fld3} syscall=%{fld4} success=%{fld5} exit=%{fld6} a0=%{fld7} a1=%{fld8} a2=%{fld9} a3=%{fld10} items=%{fld11} ppid=%{fld12} pid=%{fld13} auid=%{fld14} uid=%{fld15} gid=%{fld16} euid=%{fld17} suid=%{fld18} fsuid=%{fld19} egid=%{fld20} sgid=%{fld21} fsgid=%{fld22} tty=%{fld23} ses=%{fld24} comm=%{fld25} exe=%{fld26} subj=%{fld27} key=%{fld28}" }
			id => "msgParserId17"
			add_field => {
				"action" => "syscall"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId18
	# line in RSA:  msg=<fld2> cwd=<fld3>
	else if [logstash][msgparser][id] == "msgParserId18" {
		dissect {
			mapping => { "message" => "msg=%{fld2} cwd=%{fld3}" }
			id => "msgParserId18"
			add_field => {
				"action" => "CWD"
				"[logstash][messagefound]" => true
			}
		}
	}
	else if [logstash][msgparser][id] == "PATH" {
		# MESSAGE PATH
		# line in RSA:  msg=<fld2> item=<fld3> name=<fld11> inode=<fld4> dev=<fld5> mode=<fld6> ouid=<fld7> ogid=<fld8> rdev=<fld9> obj=<fld10>
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} item=%{fld3} name=%{fld11} inode=%{fld4} dev=%{fld5} mode=%{fld6} ouid=%{fld7} ogid=%{fld8} rdev=%{fld9} obj=%{fld10}" }
				id => "message-PATH"
				add_field => {
				"action" => "Path"
					"[event][id]" => "PATH"
					"[rsa][message][id1]" => "PATH"
					"[event][categoryid]" => "1605000000"
					"[logstash][messagefound]" => true
				}
			}
		}
		# MESSAGE PATH:01
		# line in RSA:  msg=<fld2> item=<fld3> name=<fld11> 
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} item=%{fld3} name=%{fld11}" }
				id => "message-PATH:01"
				add_field => {
				"action" => "Path"
					"[event][id]" => "PATH:01"
					"[rsa][message][id1]" => "PATH:01"
					"[event][categoryid]" => "1605000000"
					"[logstash][messagefound]" => true
				}
			}
		}
	}
	# PARSER msgParserId21
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> reason=<result> vm=<application> uuid=<fld10> exe=<fld11> hostname=<hostname> addr=<hostip> terminal=<fld12> res=<fld13>'
	else if [logstash][msgparser][id] == "msgParserId21" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} reason=%{result} vm=%{application} uuid=%{fld10} exe=%{fld11} hostname=%{hostname} addr=%{hostip} terminal=%{fld12} res=%{fld13}'" }
			id => "msgParserId21"
			add_field => {
				"action" => "Virtual Control"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId22
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> reason=<result> vm=<application> uuid=<fld10> exe=<fld11> hostname=<hostname> addr=<hostip> terminal=<fld12> res=<fld13>'
	else if [logstash][msgparser][id] == "msgParserId22" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} reason=%{result} vm=%{application} uuid=%{fld10} exe=%{fld11} hostname=%{hostname} addr=%{hostip} terminal=%{fld12} res=%{fld13}'" }
			id => "msgParserId22"
			add_field => {
				"action" => "Virtual Resource"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId23
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> acct=<fld8> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId23" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} acct=%{fld8} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId23"
			add_field => {
				"action" => "User Authentication"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId24
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId24" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId24"
			add_field => {
				"action" => "User Role Change"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId25
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='op=<info> acct=<fld8> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId25" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='op=%{info} acct=%{fld8} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId25"
			add_field => {
				"action" => "Cred Refr"
				"[logstash][messagefound]" => true
			}
		}
	}
	else if [logstash][msgparser][id] == "EXECVE" {
		# MESSAGE EXECVE
		# line in RSA:  msg=<fld2> argc=<fld3> a0=<fld4> a1=<fld5> 
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} argc=%{fld3} a0=%{fld4} a1=%{fld5}" }
				id => "message-EXECVE"
				add_field => {
				"action" => "EXECVE"
					"[event][id]" => "EXECVE"
					"[rsa][message][id1]" => "EXECVE"
					"[event][categoryid]" => "1605000000"
					"[logstash][messagefound]" => true
				}
			}
		}
		# MESSAGE EXECVE:01
		# line in RSA:  msg=<fld2> argc=<fld3> a0=<fld4> 
		if ![logstash][messagefound] {
			dissect {
				mapping => { "message" => "msg=%{fld2} argc=%{fld3} a0=%{fld4}" }
				id => "message-EXECVE:01"
				add_field => {
				"action" => "EXECVE"
					"[event][id]" => "EXECVE:01"
					"[rsa][message][id1]" => "EXECVE:01"
					"[event][categoryid]" => "1605000000"
					"[logstash][messagefound]" => true
				}
			}
		}
	}
	# PARSER msgParserId28
	# line in RSA:  msg=<fld2> fver=<fld3> fp=<fld4> fi=<fld5> fe=<fld6> old_pp=<fld7> old_pi=<fld8> old_pe=<fld9> new_pp=<fld10> new_pi=<fld11> new_pe=<fld12>
	else if [logstash][msgparser][id] == "msgParserId28" {
		dissect {
			mapping => { "message" => "msg=%{fld2} fver=%{fld3} fp=%{fld4} fi=%{fld5} fe=%{fld6} old_pp=%{fld7} old_pi=%{fld8} old_pe=%{fld9} new_pp=%{fld10} new_pi=%{fld11} new_pe=%{fld12}" }
			id => "msgParserId28"
			add_field => {
				"action" => "BPRM_FCAPS"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId29
	# line in RSA:  msg=<fld2> saddr=<fld3> 
	else if [logstash][msgparser][id] == "msgParserId29" {
		dissect {
			mapping => { "message" => "msg=%{fld2} saddr=%{fld3}" }
			id => "msgParserId29"
			add_field => {
				"action" => "Sock Address"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId30
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId30" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId30"
			add_field => {
				"action" => "System Runlevel"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId31
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId31" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId31"
			add_field => {
				"action" => "System Shutdown"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId32
	# line in RSA:  msg=<fld2> initialized 
	else if [logstash][msgparser][id] == "msgParserId32" {
		dissect {
			mapping => { "message" => "msg=%{fld2} initialized" }
			id => "msgParserId32"
			add_field => {
				"action" => "Kernel"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId33
	# line in RSA:  msg=<fld2> enforcing=<fld3> old_enforcing=<fld4> auid=<fld5> ses=<fld6>
	else if [logstash][msgparser][id] == "msgParserId33" {
		dissect {
			mapping => { "message" => "msg=%{fld2} enforcing=%{fld3} old_enforcing=%{fld4} auid=%{fld5} ses=%{fld6}" }
			id => "msgParserId33"
			add_field => {
				"action" => "Mac status"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId34
	# line in RSA:  msg=<fld2> auid=<fld3> ses=<fld4> 
	else if [logstash][msgparser][id] == "msgParserId34" {
		dissect {
			mapping => { "message" => "msg=%{fld2} auid=%{fld3} ses=%{fld4}" }
			id => "msgParserId34"
			add_field => {
				"action" => "Mac policy load"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId35
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> exe=<fld9> hostname=<hostname> addr=<hostip> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId35" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} exe=%{fld9} hostname=%{hostname} addr=%{hostip} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId35"
			add_field => {
				"action" => "System Boot"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId36
	# line in RSA:  msg=<fld2> table=<fld3> family=<fld4> entries=<fld5> 
	else if [logstash][msgparser][id] == "msgParserId36" {
		dissect {
			mapping => { "message" => "msg=%{fld2} table=%{fld3} family=%{fld4} entries=%{fld5}" }
			id => "msgParserId36"
			add_field => {
				"action" => "Netfilter cfg"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId37
	# line in RSA:  msg=<fld2> fd0=<fld3> fd1=<fld4> 
	else if [logstash][msgparser][id] == "msgParserId37" {
		dissect {
			mapping => { "message" => "msg=%{fld2} fd0=%{fld3} fd1=%{fld4}" }
			id => "msgParserId37"
			add_field => {
				"action" => "FD Pair"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId38
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> cmd=<fld9> terminal=<fld11> res=<result>'
	else if [logstash][msgparser][id] == "msgParserId38" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} cmd=%{fld9} terminal=%{fld11} res=%{result}'" }
			id => "msgParserId38"
			add_field => {
				"action" => "User Cmd"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId39
	# line in RSA:  msg=<fld2> auid=<fld3> uid=<fld4> gid=<fld5> ses=<fld6> subj=<fld7> pid=<fld9> comm=<info> sig=<fld10>
	else if [logstash][msgparser][id] == "msgParserId39" {
		dissect {
			mapping => { "message" => "msg=%{fld2} auid=%{fld3} uid=%{fld4} gid=%{fld5} ses=%{fld6} subj=%{fld7} pid=%{fld9} comm=%{info} sig=%{fld10}" }
			id => "msgParserId39"
			add_field => {
				"action" => "Anom Abend"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId40
	# line in RSA:  msg=<fld2> pid=<fld3> comm=<info> { path | name }=<fld5> dev=<fld6> ino=<fld7> scontext=<fld9> tcontext=<fld10> tclass=<fld11>
	else if [logstash][msgparser][id] == "msgParserId40" {
		grok {
			match => { "message" => "^[\s]*msg=(?<fld2>[^\s]*)[\s]+pid=(?<fld3>[^\s]*)[\s]+comm=(?<info>[^\s]*)[\s]+([\s]*path[\s]+|[\s]*name[\s]+)=(?<fld5>[^\s]*)[\s]+dev=(?<fld6>[^\s]*)[\s]+ino=(?<fld7>[^\s]*)[\s]+scontext=(?<fld9>[^\s]*)[\s]+tcontext=(?<fld10>[^\s]*)[\s]+tclass=(?<fld11>.*)$" }
			id => "msgParserId40"
			add_field => {
				"action" => "AVC"
				"[logstash][messagefound]" => true
			}
		}
	}
	# PARSER msgParserId41
	# line in RSA:  msg=<fld2> user pid=<fld3> uid=<fld4> auid=<fld5> ses=<fld6> subj=<fld7> msg='<info> vm=<application> uuid=<fld10> vm-ctx=<fld20> img-ctx=<fld21> exe=<fld11> hostname=<hostname> addr=<hostip> terminal=<fld12> res=<fld13>'
	else if [logstash][msgparser][id] == "msgParserId41" {
		dissect {
			mapping => { "message" => "msg=%{fld2} user pid=%{fld3} uid=%{fld4} auid=%{fld5} ses=%{fld6} subj=%{fld7} msg='%{info} vm=%{application} uuid=%{fld10} vm-ctx=%{fld20} img-ctx=%{fld21} exe=%{fld11} hostname=%{hostname} addr=%{hostip} terminal=%{fld12} res=%{fld13}'" }
			id => "msgParserId41"
			add_field => {
				"action" => "Virtual Machine ID"
				"[logstash][messagefound]" => true
			}
		}
	}


################## END OF MESSAGES ##################

# End of the filter block
}


output {
#	if [logstash][headerfound] and [logstash][messagefound] {
#		elasticsearch {
#			hosts => ["https://elasticxxxxxx"]
#			index => "%{[observer][product]}-%{+YYYY.MM.dd}"
#			user => "logstash"
#			password => "abc"	# Better use keystore, cf https://www.elastic.co/guide/en/logstash/master/keystore.html
#			manage_template => true
#			template => "es-mapping-kvmmsg.json"
#			template_name => "kvm_template"
#			template_overwrite => true
#		}
#	} else {
#		# using a file output for logs that were not parsed correctly
#		# should you chose to send it to elasticsearch, please read https://discuss.elastic.co/t/latency-with-2-elasticsearch-systems/170074/2
#		file { path => "failed_logs-%{[observer][product]}-%{+YYYY-MM-dd}" }
#	}
	stdout {
		codec => rubydebug
	}
}
